<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Tshepang Lekhonkhobe" />
        <meta name="copyright" content="Tshepang Lekhonkhobe" />

<meta name="keywords" content="Debian, computing, " />
        <title>removing obsolete packages from a local Debian repository - Tshepang logs
</title>
        <link href="http://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://tshepang.net/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://tshepang.net/theme/css/solarizedlight.css" media="screen">
        <link rel="shortcut icon" href="http://tshepang.net/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="http://tshepang.net/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="http://tshepang.net/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="http://tshepang.net/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="http://tshepang.net/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="http://tshepang.net/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="http://tshepang.net/theme/images/apple-touch-icon-144x144.png" />
        <link href="http://tshepang.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Tshepang logs - Full Atom Feed" />
        <link href="http://tshepang.net/feeds/arts.atom.xml" type="application/atom+xml" rel="alternate" title="Tshepang logs - arts Category Atom Feed" />
        <link href="http://tshepang.net/feeds/computing.atom.xml" type="application/atom+xml" rel="alternate" title="Tshepang logs - computing Category Atom Feed" />
        <link href="http://tshepang.net/feeds/misc.atom.xml" type="application/atom+xml" rel="alternate" title="Tshepang logs - misc Category Atom Feed" />
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16685250-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://tshepang.net/"><span class=site-name>Tshepang logs</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://tshepang.net">Home</a></li>
                            <li ><a href="http://tshepang.net/about-me.html">about me</a></li>
                            <li ><a href="http://tshepang.net/[(<Category arts>, [<pelican.contents.Article object at 0x7f80529d7b10>, <pelican.contents.Article object at 0x7f805299e4d0>, <pelican.contents.Article object at 0x7f8052a3b310>, <pelican.contents.Article object at 0x7f8052959690>, <pelican.contents.Article object at 0x7f8052959590>, <pelican.contents.Article object at 0x7f805294db10>, <pelican.contents.Article object at 0x7f8052970610>, <pelican.contents.Article object at 0x7f80529d7ed0>, <pelican.contents.Article object at 0x7f805299b190>, <pelican.contents.Article object at 0x7f80516fc610>, <pelican.contents.Article object at 0x7f8052db2f90>, <pelican.contents.Article object at 0x7f80529dcfd0>, <pelican.contents.Article object at 0x7f805299b390>, <pelican.contents.Article object at 0x7f8051734390>, <pelican.contents.Article object at 0x7f805294d190>, <pelican.contents.Article object at 0x7f8052db2990>, <pelican.contents.Article object at 0x7f8052945ed0>, <pelican.contents.Article object at 0x7f8052982490>, <pelican.contents.Article object at 0x7f8052db9990>, <pelican.contents.Article object at 0x7f805299b550>, <pelican.contents.Article object at 0x7f805296c4d0>, <pelican.contents.Article object at 0x7f8052db9c50>, <pelican.contents.Article object at 0x7f80529f1a10>, <pelican.contents.Article object at 0x7f8052982090>, <pelican.contents.Article object at 0x7f805296fb10>, <pelican.contents.Article object at 0x7f8052945490>, <pelican.contents.Article object at 0x7f8052970cd0>, <pelican.contents.Article object at 0x7f80529f9690>, <pelican.contents.Article object at 0x7f805294de90>, <pelican.contents.Article object at 0x7f805173d650>, <pelican.contents.Article object at 0x7f805173d190>, <pelican.contents.Article object at 0x7f8052d87450>, <pelican.contents.Article object at 0x7f8052947990>, <pelican.contents.Article object at 0x7f8052982450>, <pelican.contents.Article object at 0x7f805171cfd0>, <pelican.contents.Article object at 0x7f805294da90>, <pelican.contents.Article object at 0x7f80529450d0>, <pelican.contents.Article object at 0x7f80516d5690>]), (<Category computing>, [<pelican.contents.Article object at 0x7f8051449c50>, <pelican.contents.Article object at 0x7f8052901cd0>, <pelican.contents.Article object at 0x7f8051643d10>, <pelican.contents.Article object at 0x7f80514c3b10>, <pelican.contents.Article object at 0x7f80514a92d0>, <pelican.contents.Article object at 0x7f80516d5d50>, <pelican.contents.Article object at 0x7f8051533ad0>, <pelican.contents.Article object at 0x7f8051458210>, <pelican.contents.Article object at 0x7f805168a310>, <pelican.contents.Article object at 0x7f80516b6e50>, <pelican.contents.Article object at 0x7f805296c710>, <pelican.contents.Article object at 0x7f80516fc5d0>, <pelican.contents.Article object at 0x7f80516fc250>, <pelican.contents.Article object at 0x7f80516ba450>, <pelican.contents.Article object at 0x7f80516ba890>, <pelican.contents.Article object at 0x7f805162d810>, <pelican.contents.Article object at 0x7f80516f2390>, <pelican.contents.Article object at 0x7f80514c3750>, <pelican.contents.Article object at 0x7f80514a7850>, <pelican.contents.Article object at 0x7f805299ed10>, <pelican.contents.Article object at 0x7f8051514310>, <pelican.contents.Article object at 0x7f80515e9b10>, <pelican.contents.Article object at 0x7f80515a7050>, <pelican.contents.Article object at 0x7f8051458bd0>, <pelican.contents.Article object at 0x7f8051562590>, <pelican.contents.Article object at 0x7f80514b4410>, <pelican.contents.Article object at 0x7f80514a7fd0>, <pelican.contents.Article object at 0x7f805157a450>, <pelican.contents.Article object at 0x7f805151b490>, <pelican.contents.Article object at 0x7f80514642d0>, <pelican.contents.Article object at 0x7f805151bbd0>, <pelican.contents.Article object at 0x7f80515003d0>, <pelican.contents.Article object at 0x7f80514a87d0>, <pelican.contents.Article object at 0x7f80514a7890>, <pelican.contents.Article object at 0x7f80514a7350>, <pelican.contents.Article object at 0x7f805155b250>, <pelican.contents.Article object at 0x7f80516d54d0>, <pelican.contents.Article object at 0x7f805299e410>, <pelican.contents.Article object at 0x7f80514b4ad0>, <pelican.contents.Article object at 0x7f805169ff90>, <pelican.contents.Article object at 0x7f80515a7450>, <pelican.contents.Article object at 0x7f80516635d0>, <pelican.contents.Article object at 0x7f80529dc390>, <pelican.contents.Article object at 0x7f8052945310>, <pelican.contents.Article object at 0x7f805161fed0>, <pelican.contents.Article object at 0x7f80514a23d0>, <pelican.contents.Article object at 0x7f80514a8090>, <pelican.contents.Article object at 0x7f8052a3b950>, <pelican.contents.Article object at 0x7f8052a4b0d0>, <pelican.contents.Article object at 0x7f805158c4d0>, <pelican.contents.Article object at 0x7f8052da0110>, <pelican.contents.Article object at 0x7f8051461bd0>, <pelican.contents.Article object at 0x7f805161fc10>, <pelican.contents.Article object at 0x7f80515148d0>, <pelican.contents.Article object at 0x7f80516d53d0>, <pelican.contents.Article object at 0x7f80514a5450>, <pelican.contents.Article object at 0x7f80514a5a50>, <pelican.contents.Article object at 0x7f8051587490>, <pelican.contents.Article object at 0x7f8052d84890>, <pelican.contents.Article object at 0x7f805168af50>, <pelican.contents.Article object at 0x7f80515f1fd0>, <pelican.contents.Article object at 0x7f805155b710>, <pelican.contents.Article object at 0x7f80514c3350>, <pelican.contents.Article object at 0x7f80514583d0>, <pelican.contents.Article object at 0x7f80514a97d0>, <pelican.contents.Article object at 0x7f80515e9950>, <pelican.contents.Article object at 0x7f805296c510>, <pelican.contents.Article object at 0x7f8051449890>, <pelican.contents.Article object at 0x7f8051449850>, <pelican.contents.Article object at 0x7f8051554950>, <pelican.contents.Article object at 0x7f80514a8610>, <pelican.contents.Article object at 0x7f80516bac90>, <pelican.contents.Article object at 0x7f805138fc10>, <pelican.contents.Article object at 0x7f80516d1e90>, <pelican.contents.Article object at 0x7f805169f0d0>, <pelican.contents.Article object at 0x7f8051461450>, <pelican.contents.Article object at 0x7f8051674150>, <pelican.contents.Article object at 0x7f80516e9410>, <pelican.contents.Article object at 0x7f805155b4d0>, <pelican.contents.Article object at 0x7f80515f9890>, <pelican.contents.Article object at 0x7f80515874d0>, <pelican.contents.Article object at 0x7f8051543890>, <pelican.contents.Article object at 0x7f8051735650>, <pelican.contents.Article object at 0x7f8052970090>, <pelican.contents.Article object at 0x7f805169fa50>, <pelican.contents.Article object at 0x7f805168af10>, <pelican.contents.Article object at 0x7f8051449d10>, <pelican.contents.Article object at 0x7f80516bab10>, <pelican.contents.Article object at 0x7f8051554110>, <pelican.contents.Article object at 0x7f8051619950>, <pelican.contents.Article object at 0x7f80516bc5d0>, <pelican.contents.Article object at 0x7f8051404f90>, <pelican.contents.Article object at 0x7f8051616a10>, <pelican.contents.Article object at 0x7f80516bcf90>, <pelican.contents.Article object at 0x7f8051411a50>, <pelican.contents.Article object at 0x7f805144c510>, <pelican.contents.Article object at 0x7f8057d0cd90>, <pelican.contents.Article object at 0x7f80516ba610>, <pelican.contents.Article object at 0x7f805157a1d0>, <pelican.contents.Article object at 0x7f8051619850>, <pelican.contents.Article object at 0x7f80514a9a90>, <pelican.contents.Article object at 0x7f80515a7250>, <pelican.contents.Article object at 0x7f80515502d0>, <pelican.contents.Article object at 0x7f8052901250>, <pelican.contents.Article object at 0x7f80514a8b50>, <pelican.contents.Article object at 0x7f8051514950>, <pelican.contents.Article object at 0x7f8051514110>, <pelican.contents.Article object at 0x7f80514a5750>, <pelican.contents.Article object at 0x7f80514ea6d0>, <pelican.contents.Article object at 0x7f805296c750>, <pelican.contents.Article object at 0x7f80516d5990>, <pelican.contents.Article object at 0x7f805169f110>, <pelican.contents.Article object at 0x7f8051643c90>, <pelican.contents.Article object at 0x7f805158c1d0>, <pelican.contents.Article object at 0x7f80516b6ad0>, <pelican.contents.Article object at 0x7f805157ad50>, <pelican.contents.Article object at 0x7f8051674990>, <pelican.contents.Article object at 0x7f8051673dd0>, <pelican.contents.Article object at 0x7f80514a22d0>, <pelican.contents.Article object at 0x7f8051461350>, <pelican.contents.Article object at 0x7f805168a710>, <pelican.contents.Article object at 0x7f805157e3d0>, <pelican.contents.Article object at 0x7f805162dad0>, <pelican.contents.Article object at 0x7f80517357d0>, <pelican.contents.Article object at 0x7f80516b63d0>, <pelican.contents.Article object at 0x7f805161ea90>, <pelican.contents.Article object at 0x7f805294d650>, <pelican.contents.Article object at 0x7f8051415a10>, <pelican.contents.Article object at 0x7f805162dc50>, <pelican.contents.Article object at 0x7f80515b23d0>, <pelican.contents.Article object at 0x7f805169f910>, <pelican.contents.Article object at 0x7f80516d5050>, <pelican.contents.Article object at 0x7f805157ef50>, <pelican.contents.Article object at 0x7f8051550ad0>, <pelican.contents.Article object at 0x7f8051674a10>, <pelican.contents.Article object at 0x7f80515a7a50>, <pelican.contents.Article object at 0x7f80515bc510>, <pelican.contents.Article object at 0x7f8051674fd0>, <pelican.contents.Article object at 0x7f80514b4750>, <pelican.contents.Article object at 0x7f80514a7190>, <pelican.contents.Article object at 0x7f805142d210>, <pelican.contents.Article object at 0x7f805161e790>, <pelican.contents.Article object at 0x7f80516f2b90>, <pelican.contents.Article object at 0x7f8052982890>, <pelican.contents.Article object at 0x7f80516d1790>, <pelican.contents.Article object at 0x7f80515b2c50>, <pelican.contents.Article object at 0x7f80514a5a10>, <pelican.contents.Article object at 0x7f8051734610>, <pelican.contents.Article object at 0x7f80514618d0>, <pelican.contents.Article object at 0x7f805173d410>, <pelican.contents.Article object at 0x7f8051547550>, <pelican.contents.Article object at 0x7f805161f990>, <pelican.contents.Article object at 0x7f8051558190>, <pelican.contents.Article object at 0x7f80515a7110>, <pelican.contents.Article object at 0x7f80529d7e90>, <pelican.contents.Article object at 0x7f8051547c10>, <pelican.contents.Article object at 0x7f8052a4b350>, <pelican.contents.Article object at 0x7f8057d0e490>, <pelican.contents.Article object at 0x7f805161ead0>, <pelican.contents.Article object at 0x7f80515f9090>, <pelican.contents.Article object at 0x7f805162f690>, <pelican.contents.Article object at 0x7f80515eee50>, <pelican.contents.Article object at 0x7f80514a86d0>, <pelican.contents.Article object at 0x7f8051586d10>, <pelican.contents.Article object at 0x7f80516d5fd0>, <pelican.contents.Article object at 0x7f805151bf10>, <pelican.contents.Article object at 0x7f80514490d0>, <pelican.contents.Article object at 0x7f8051586210>, <pelican.contents.Article object at 0x7f80513cb4d0>, <pelican.contents.Article object at 0x7f80514b4950>, <pelican.contents.Article object at 0x7f80514a9510>, <pelican.contents.Article object at 0x7f80529dc890>, <pelican.contents.Article object at 0x7f805158c410>]), (<Category misc>, [<pelican.contents.Article object at 0x7f805171c950>, <pelican.contents.Article object at 0x7f8052963950>, <pelican.contents.Article object at 0x7f805294d4d0>, <pelican.contents.Article object at 0x7f8051674750>, <pelican.contents.Article object at 0x7f805162fc90>, <pelican.contents.Article object at 0x7f8051547190>, <pelican.contents.Article object at 0x7f805296c190>, <pelican.contents.Article object at 0x7f80516b2dd0>, <pelican.contents.Article object at 0x7f805173db10>, <pelican.contents.Article object at 0x7f80515e9f90>, <pelican.contents.Article object at 0x7f80529dc050>, <pelican.contents.Article object at 0x7f8051734310>, <pelican.contents.Article object at 0x7f8052d96850>, <pelican.contents.Article object at 0x7f805294d8d0>, <pelican.contents.Article object at 0x7f80516b2810>, <pelican.contents.Article object at 0x7f80529f1850>, <pelican.contents.Article object at 0x7f8052d96690>, <pelican.contents.Article object at 0x7f8052a18290>, <pelican.contents.Article object at 0x7f8052d9b550>, <pelican.contents.Article object at 0x7f80516b6550>, <pelican.contents.Article object at 0x7f80516636d0>, <pelican.contents.Article object at 0x7f80529f9110>, <pelican.contents.Article object at 0x7f80529f1d50>, <pelican.contents.Article object at 0x7f8051674a90>, <pelican.contents.Article object at 0x7f80515bc6d0>, <pelican.contents.Article object at 0x7f8052d96750>, <pelican.contents.Article object at 0x7f80516b2790>, <pelican.contents.Article object at 0x7f8051735890>, <pelican.contents.Article object at 0x7f805296c3d0>, <pelican.contents.Article object at 0x7f8051628b50>, <pelican.contents.Article object at 0x7f8052db9610>, <pelican.contents.Article object at 0x7f8051734a50>, <pelican.contents.Article object at 0x7f8052945dd0>, <pelican.contents.Article object at 0x7f8051735e50>, <pelican.contents.Article object at 0x7f80515f1890>, <pelican.contents.Article object at 0x7f805161dfd0>, <pelican.contents.Article object at 0x7f8051734d50>, <pelican.contents.Article object at 0x7f80516fca10>, <pelican.contents.Article object at 0x7f8051674690>, <pelican.contents.Article object at 0x7f8052a3bf50>, <pelican.contents.Article object at 0x7f80516634d0>, <pelican.contents.Article object at 0x7f80529f9310>, <pelican.contents.Article object at 0x7f80516b6950>, <pelican.contents.Article object at 0x7f80516163d0>, <pelican.contents.Article object at 0x7f8051735290>, <pelican.contents.Article object at 0x7f8052d96290>, <pelican.contents.Article object at 0x7f805299b4d0>, <pelican.contents.Article object at 0x7f8052a185d0>, <pelican.contents.Article object at 0x7f8052945a10>, <pelican.contents.Article object at 0x7f80515bc050>, <pelican.contents.Article object at 0x7f8052daacd0>, <pelican.contents.Article object at 0x7f80516bcc50>, <pelican.contents.Article object at 0x7f80529dc350>, <pelican.contents.Article object at 0x7f8052df9590>, <pelican.contents.Article object at 0x7f805171c1d0>, <pelican.contents.Article object at 0x7f8051735ed0>, <pelican.contents.Article object at 0x7f80516162d0>, <pelican.contents.Article object at 0x7f80529f1790>, <pelican.contents.Article object at 0x7f8051547350>, <pelican.contents.Article object at 0x7f805294d150>, <pelican.contents.Article object at 0x7f8052a4b310>])]">Categories</a></li>
                            <li ><a href="http://tshepang.net/tags.html">Tags</a></li>
                            <li ><a href="http://tshepang.net/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://tshepang.net/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="http://tshepang.net/removing-obsolete-packages-from-a-local-debian-repository"> removing obsolete packages from a local Debian repository  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            <div class="section" id="background-info">
<h2>background info</h2>
<p>Bandwidth in South Africa is neither readily-available nor cheap, so
whenever I fetch and install Debian packages (e.g. <tt class="docutils literal"><span class="pre">apt-get</span> upgrade</tt>),
I also keep them in a local custom repository. I use a great tool named
<a class="reference external" href="http://mirrorer.alioth.debian.org/">reprepro</a> for this, and this is the command I use to update that
repository, given the location of the fresh package files:</p>
<pre class="literal-block">
$ reprepro -vv --basedir ~/.custom_repo/ includedeb tshepang /var/cache/apt/archives/*deb
</pre>
<p>What's nice about the command is that, if there is an older version of
the pacakge I'm adding, it gets replaced, and the package index is
update accordingly.</p>
</div>
<div class="section" id="and-now-to-the-topic-at-hand">
<h2>and now to the topic at hand</h2>
<p>I run that command more or less regularly, but very often the repository
accumulates some junk:</p>
<ul class="simple">
<li>If a package gets renamed, reprepro has no way of knowing (at least
as far as my setup goes). One notable case of this is Debian kernels,
whose names match the major release versions (e.g.
<tt class="docutils literal"><span class="pre">linux-image-3.1.0-1-686-pae</span></tt> becomes
<tt class="docutils literal"><span class="pre">linux-image-3.2.0-1-686-pae</span></tt> when a new upstream release gets
packaged). Lots other packages change names, and very often, for a
variety of reasons (Debian is a little chaotic, often out of
necessity, and it's amazing that its developers keep it so damn
stable given all this change).</li>
<li>If I add a package from an external repository or that I converted
from an rpm, reprepro has no way of knowing that fact. Now if I stop
using that package, it is just a waste of resources (CPU and disk
usage).</li>
</ul>
<p>To help with the cleanup, I have written the following simple script:</p>
<div class="highlight"><pre><span class="c">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">apt_pkg</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">CUSTOM_REPO</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;/home/wena/.custom_repo/dists/tshepang/main/&quot;</span>
               <span class="s">&quot;binary-i386/Packages.gz&quot;</span><span class="p">)</span>
<span class="n">WHEEZY_REPO</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;/var/lib/apt/lists/ftp.de.debian.org_debian_dists_testing_{}_&quot;</span>
               <span class="s">&quot;binary-i386_Packages&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">custom_repo</span> <span class="o">=</span> <span class="n">apt_pkg</span><span class="o">.</span><span class="n">TagFile</span><span class="p">(</span><span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">CUSTOM_REPO</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">))</span>
    <span class="n">archive_areas</span> <span class="o">=</span> <span class="s">&quot;main contrib non-free&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">wheezy_packages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">archive_area</span> <span class="ow">in</span> <span class="n">archive_areas</span><span class="p">:</span>
        <span class="n">repo</span> <span class="o">=</span> <span class="n">WHEEZY_REPO</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">archive_area</span><span class="p">)</span>
        <span class="n">repo</span> <span class="o">=</span> <span class="n">apt_pkg</span><span class="o">.</span><span class="n">TagFile</span><span class="p">(</span><span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">repo</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">))</span>
        <span class="n">wheezy_packages</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">pkg</span><span class="p">[</span><span class="s">&quot;Package&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">repo</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">custom_repo</span><span class="p">:</span>
        <span class="n">package_name</span> <span class="o">=</span> <span class="n">package</span><span class="p">[</span><span class="s">&quot;Package&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">package_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wheezy_packages</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;apt-cache policy &quot;</span> <span class="o">+</span> <span class="n">package_name</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">&quot;remove from cache [Y/n]? &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">choice</span> <span class="ow">or</span> <span class="n">choice</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">):</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;reprepro -vv --basedir /home/wena/.custom_repo/ &quot;</span>
                       <span class="s">&quot;remove tshepang &quot;</span> <span class="o">+</span> <span class="n">package_name</span><span class="p">)</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
<p>And here's a snippet of its output:</p>
<pre class="literal-block">
cx-oracle:
  Installed: 5.1.1-2
  Candidate: 5.1.1-2
  Version table:
 *** 5.1.1-2 0
        500 file:/home/wena/.custom_repo/ tshepang/main i386 Packages
        100 /var/lib/dpkg/status
remove from cache [Y/n]?
</pre>
<p>What it does is look for packages which are only available in my custom
reposity, as compared with the one in Wheezy (soon to be Debian 7). It
then prompts me on whether or not to remove it from that custom
repository. Today, it helped me get rid of dozens of junk.</p>
</div>

            <aside>
            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">« <a href="http://tshepang.net/links-2012-02-15" title="Previous: links 2012-02-15">links 2012-02-15</a></li>
 
                <li class="next_article"><a href="http://tshepang.net/wajig-23-released" title="Next: wajig 2.3 released">wajig 2.3 released</a> »</li>
            </ul>
            </nav>
            </aside>
<section>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2"
                href="http://tshepang.net/removing-obsolete-packages-from-a-local-debian-repository#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'tshepanglogs';
        var disqus_identifier = 'http://tshepang.net/removing-obsolete-packages-from-a-local-debian-repository';
    var disqus_url = 'http://tshepang.net/removing-obsolete-packages-from-a-local-debian-repository';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>                </div>
            </div>
        </div>
    </div>
</div>
</section>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2012-02-21T00:00:00">Feb 21, 2012</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#computing-ref">computing</a> 
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                <li><a href="/tags.html#Debian-ref">Debian
                    <span>42</span>
</a></li>
            </ul>

        </div>
        </section>
    </div>
    </article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-license"><a rel="license"
href="http://creativecommons.org/licenses/by-sa/3.0/"><img
alt="Creative Commons License" style="border-width:0"
src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" /></a><br
/>This work is licensed under a <a rel="license"
href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons
Attribution-ShareAlike 3.0 Unported License</a>.</li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

<script type="text/javascript">
    var disqus_shortname = 'tshepanglogs';

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    </body>
</html>